<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page - My ASP.NET Application</title>
    <link href="/Content/bootstrap.css" rel="stylesheet" />
    <link href="/Content/site.css" rel="stylesheet" />

    <script src="/Scripts/modernizr-2.8.3.js"></script>

</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Welcome to "real" IoT Web Server! :)</a>
            </div>
            <div class="navbar-collapse collapse">
                <ul class="nav navbar-nav">
                    <!--<li><a href="/">Home</a></li>
                    <li><a href="/Home/About">About</a></li>
                    <li><a href="/Home/Contact">Contact</a></li>-->
                </ul>
            </div>
        </div>
    </div>
    <div class="container body-content">

        <div class="jumbotron">
            <h1>Weather station</h1>
            <p class="lead">Press button to update current temperature.</p>

           <h2> <span id="temp" class="label label-info">[Press Update button]</span></h2>

            <button id="updateButton" type="button" class="btn btn-primary">Update</button>
            <button id="connectButton" type="button" class="btn btn-primary">Connect</button>
        </div>
        <hr />
        <footer>
            <p>&copy; 2016 - My ASP.NET Application</p>
        </footer>
    </div>

    <script src="/Scripts/jquery-2.2.0.js"></script>

    <script src="/Scripts/bootstrap.js"></script>
    <script src="/Scripts/respond.js"></script>

    <script type="text/javascript">
        $('#updateButton').click(function () {
            $.ajax({
                type: "GET",
                url: "api/temperature/bysensor/0",
                success: function (data) {
                    var span = document.getElementById('temp');
                    if ('textContent' in span) {
                        span.textContent = data.Temperature;
                    }
                    else {
                        span.innerText = data.Temperature;
                    }
                },
                error: function (data) {
                    alert("Error");
                }
            });
        });
		
        $('#connectButton').click(function () {

            var ws = new WebSocket("ws://192.168.1.12:8000/signalr");

            ws.onopen = function () {
                alert("About to send data");
                ws.send("Hello World"); // I WANT TO SEND THIS MESSAGE TO THE SERVER!!!!!!!!
                alert("Message sent!");
            };

            ws.onmessage = function (evt) {
                alert("About to receive data");
                var received_msg = evt.data;
                alert("Message received = " + received_msg);
            };

            ws.onclose = function () {
                // websocket is closed.
                alert("Connection is closed...");
            };
        }); 
		
    </script>

</body>
</html>
